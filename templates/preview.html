{% extends "base.html" %}

{% block title %}Pass Preview - {{ pass_data.name1 }}{% endblock %}

{% block styles %}
<style>
    body {
        background: linear-gradient(135deg, #1a0033 0%, #330066 50%, #4d0099 100%);
        min-height: 100vh;
    }
    
    .pass-preview {
        max-width: 450px;
        margin: 0 auto;
        background: linear-gradient(135deg, #6B1B9A 0%, #D84315 50%, #FF6F00 100%);
        border-radius: 20px;
        padding: 0;
        color: white;
        box-shadow: 0 25px 70px rgba(255, 111, 0, 0.4), 0 0 50px rgba(107, 27, 154, 0.3);
        position: relative;
        overflow: hidden;
        border: 3px solid rgba(255, 193, 7, 0.6);
    }
    
    .pass-preview::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 193, 7, 0.1) 0%, transparent 70%);
        animation: glow 4s ease-in-out infinite;
        pointer-events: none;
    }
    
    @keyframes glow {
        0%, 100% { transform: translate(0, 0); opacity: 0.5; }
        50% { transform: translate(10%, 10%); opacity: 0.8; }
    }
    
    .diya-corner {
        position: absolute;
        font-size: 28px;
        opacity: 0.3;
        animation: flicker 2s infinite;
        z-index: 1;
    }
    
    .diya-top-left {
        top: 12px;
        left: 12px;
    }
    
    .diya-top-right {
        top: 12px;
        right: 12px;
    }
    
    .diya-bottom-left {
        bottom: 12px;
        left: 12px;
    }
    
    .diya-bottom-right {
        bottom: 12px;
        right: 12px;
    }
    
    @keyframes flicker {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.6; }
    }
    
    .rangoli-border {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: repeating-linear-gradient(
            90deg,
            #FF6F00 0px,
            #FFD54F 8px,
            #FF6F00 16px,
            #D84315 24px,
            #6B1B9A 32px
        );
        z-index: 2;
    }
    
    .rangoli-border-bottom {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: repeating-linear-gradient(
            90deg,
            #FF6F00 0px,
            #FFD54F 8px,
            #FF6F00 16px,
            #D84315 24px,
            #6B1B9A 32px
        );
        z-index: 2;
    }
    
    .pass-content {
        position: relative;
        z-index: 1;
        padding: 35px 25px 25px;
    }
    
    .pass-header {
        text-align: center;
        margin-top: -15px;
        margin-bottom: 15px;
        border-bottom: 3px solid rgba(255, 193, 7, 0.4);
        padding-bottom: 15px;
    }
    
    .pass-title {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 10px;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
        letter-spacing: 0.5px;
    }
    
    .pass-subtitle {
        font-size: 12px;
        opacity: 0.95;
        background: rgba(255, 193, 7, 0.3);
        display: inline-block;
        padding: 6px 20px;
        border-radius: 15px;
        font-weight: 600;
    }
    
    .pass-main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 15px 0 15px 0;
        align-items: start;
    }
    
    .pass-info-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .pass-field {
        padding: 8px 12px;
        background: rgba(0, 0, 0, 0.25);
        border-radius: 10px;
        border-left: 3px solid #FFD54F;
        backdrop-filter: blur(10px);
    }
    
    .pass-field-label {
        font-size: 9px;
        opacity: 0.85;
        margin-bottom: 4px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #FFD54F;
    }
    
    .pass-field-value {
        font-size: 15px;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        line-height: 1.3;
    }
    
    .qr-section {
        text-align: center;
        background: white;
        padding: 12px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        border: 3px solid #FFD54F;
    }
    
    .qr-header {
        color: #6B1B9A;
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .qr-code {
        margin: 10px auto;
        display: inline-block;
    }
    
    .qr-code canvas,
    .qr-code img {
        max-width: 100%;
        height: auto !important;
        width: 100% !important;
    }
    
    /* .qr-footer {
        color: #666;
        font-size: 9px;
        margin-top: 8px;
        font-weight: 500;
    } */
    
    .security-watermark {
        text-align: center;
        color: #FFD54F;
        font-size: 10px;
        margin-top: 15px;
        opacity: 0.9;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .organizer-info {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 10px;
        margin-top: -10px;
        text-align: center;
        border: 2px solid rgba(255, 193, 7, 0.3);
    }
    
    .organizer-title {
        font-size: 11px;
        opacity: 0.85;
        margin-bottom: 6px;
        color: #FFD54F;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .organizer-details {
        font-size: 14px;
        font-weight: 600;
        line-height: 1.4;
    }
    
    .terms-section {
        background: rgba(0, 0, 0, 0.4);
        padding: 20px;
        border-radius: 12px;
        margin: 20px 0 15px;
        border: 2px solid rgba(255, 193, 7, 0.3);
    }
    
    .terms-title {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 12px;
        text-align: center;
        color: #FFD54F;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .terms-list {
        font-size: 9px;
        line-height: 1.6;
        opacity: 0.9;
        text-align: left;
        padding-left: 15px;
        margin: 0;
    }
    
    .terms-list li {
        margin-bottom: 8px;
    }
    
    .terms-list li strong {
        color: #FFD54F;
    }
    
    .pass-footer {
        text-align: center;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 3px solid rgba(255, 193, 7, 0.4);
        font-size: 11px;
        opacity: 0.85;
        line-height: 1.5;
    }
    
    .action-buttons {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 25px;
    }
    
    .btn-white {
        background: white;
        color: #6B1B9A;
        font-weight: 600;
    }
    
    .btn-white:hover {
        background: #FFD54F;
        color: #6B1B9A;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 193, 7, 0.4);
    }
    
    .btn {
        transition: all 0.3s ease;
        padding: 12px 20px;
        font-size: 14px;
    }
    
    .btn:hover {
        transform: translateY(-2px);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #FF6F00, #D84315);
        border: none;
    }
    
    .btn-success:hover {
        background: linear-gradient(135deg, #D84315, #FF6F00);
        box-shadow: 0 8px 20px rgba(216, 67, 21, 0.5);
    }
    
    .header h2 {
        color: #FFD54F;
        text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.1);
    }
    
    .screenshot-hint {
        text-align: center;
        color: #FFD54F;
        font-size: 13px;
        margin: -25px 0 5px 0;
        padding: 10px;
        background: rgba(255, 193, 7, 0.1);
        border-radius: 8px;
        border: 1px dashed #FFD54F;
    }
    
    @media (max-width: 480px) {
        .pass-preview {
            max-width: 95%;
            margin: 10px auto;
        }
        
        .pass-content {
            padding: 30px 20px 20px;
        }
        
        .pass-title {
            font-size: 24px;
        }
        
        .pass-main-content {
            gap: 15px;
        }
        
        .pass-field-value {
            font-size: 14px;
        }
        
        .action-buttons {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="header">
        <h2>Pass Generated Successfully!</h2>
        <div class="user-info">
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
        </div>
    </div>
    
    <div class="screenshot-hint">
        üì± <strong>Tip:</strong> Take a screenshot of the pass below to share easily on WhatsApp!
    </div>
    
    <div id="pass-container">
        <div class="pass-preview">
            <div class="rangoli-border"></div>
            <div class="rangoli-border-bottom"></div>
            
            <div class="diya-corner diya-top-left">ü™î</div>
            <div class="diya-corner diya-top-right">ü™î</div>
            <div class="diya-corner diya-bottom-left">üéÜ</div>
            <div class="diya-corner diya-bottom-right">üéÜ</div>
            
            <div class="pass-content">
                <div class="pass-header">
                    <div class="pass-title">ü™î Diwali Party Pass ü™î</div>
                    <div class="pass-subtitle">{{ pass_data.pass_type }}</div>
                </div>
                
                <div class="pass-main-content">
                    <div class="pass-info-section">
                        <div class="pass-field">
                            <div class="pass-field-label">Name</div>
                            <div class="pass-field-value">{{ pass_data.name1 }}</div>
                        </div>
                        
                        <div class="pass-field">
                            <div class="pass-field-label">Phone</div>
                            <div class="pass-field-value">{{ pass_data.phone1 }}</div>
                        </div>
                        
                        {% if pass_data.pass_type == 'COUPLE' %}
                        <div class="pass-field">
                            <div class="pass-field-label">Partner</div>
                            <div class="pass-field-value">{{ pass_data.name2 }}</div>
                        </div>
                        
                        <div class="pass-field">
                            <div class="pass-field-label">Partner Phone</div>
                            <div class="pass-field-value">{{ pass_data.phone2 }}</div>
                        </div>
                        {% endif %}
                        
                        <div class="pass-field">
                            <div class="pass-field-label">Timing</div>
                            <div class="pass-field-value">{{ pass_data.timing }}</div>
                        </div>
                        
                        <div class="pass-field">
                            <div class="pass-field-label">Amount Paid</div>
                            <div class="pass-field-value">‚Çπ{{ pass_data.amount }}<br><small style="font-size: 12px;">({{ pass_data.payment_mode }})</small></div>
                        </div>
                    </div>
                    
                    <div class="qr-section">
                        <div class="qr-header">üîê Scan at Entry</div>
                        <div class="qr-code" id="qr-code"></div>
                        <!-- <div class="qr-footer">{{ pass_data.pass_id[:8] }}...</div> -->
                        <!-- <div class="security-watermark" style="margin-top: 8px; font-size: 8px;">‚ö†Ô∏è ONE-TIME ONLY</div> -->
                        
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 2px solid rgba(107, 27, 154, 0.2);">
                            <div style="font-size: 9px; color: #6B1B9A; font-weight: 600; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">üìû Organizer</div>
                            <div style="font-size: 11px; color: #333; font-weight: 600; line-height: 1.3;">
                                Sakshi<br>
                                <span style="font-size: 10px;">+91 9871223046
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="terms-section">
                    <div class="terms-title">‚öñÔ∏è Terms & Conditions</div>
                    <ul class="terms-list">
                        <li><strong>ONE-TIME ENTRY:</strong> QR code verified at venue. Once scanned, becomes invalid. If someone else scans first (even by mistake/screenshot), your entry will be declined. Protect your e-pass!</li>
                        <li><strong>NON-TRANSFERABLE:</strong> Registered in your name only. Non-refundable.</li>
                        <li><strong>STRICTLY NON-ALCOHOLIC:</strong> Intoxicated individuals not allowed.</li>
                        <li><strong>DRESS CODE:</strong> Traditional attire encouraged.</li>
                        <li><strong>PUNCTUALITY:</strong> Respect event timings mentioned above.</li>
                        <li><strong>BELONGINGS:</strong> Organizers not liable for lost/stolen items.</li>
                    </ul>
                </div>
                
                <div class="pass-footer">
                    üóìÔ∏è Generated: {{ pass_data.created_at }}<br>
                    ‚ú® Happy Diwali! ‚ú®<br>
                    <!-- <small style="opacity: 0.7;">Carry valid ID proof</small> -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="action-buttons">
            <button onclick="downloadPass()" class="btn btn-success">üì• Download PNG</button>
            <button onclick="printPass()" class="btn">üñ®Ô∏è Print Pass</button>
            <button onclick="shareWhatsApp()" class="btn btn-white">üí¨ Share WhatsApp</button>
            <a href="{{ url_for('generate') }}" class="btn btn-secondary">‚ûï Generate Another</a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
    // Generate QR Code
    const qrPayload = '{{ pass_data.qr_payload }}';
    const qrCode = new QRCode(document.getElementById('qr-code'), {
        text: qrPayload,
        width: 160,
        height: 160,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
    });
    
    function downloadPass() {
        const passContainer = document.getElementById('pass-container');
        
        html2canvas(passContainer, {
            backgroundColor: null,
            scale: 2,
            logging: false,
            useCORS: true
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'diwali-pass-{{ pass_data.name1 }}.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }
    
    function printPass() {
        window.print();
    }
    
    function shareWhatsApp() {
        const name = '{{ pass_data.name1 }}';
        const timing = '{{ pass_data.timing }}';
        const passType = '{{ pass_data.pass_type }}';
        const message = `ü™î *Diwali Party Pass*\n\nüë§ ${name}\nüé´ ${passType}\n‚è∞ ${timing}\n\n‚úÖ Please take screenshot of the pass and share!\n‚ö†Ô∏è *Protect your QR code - ONE-TIME entry only!*\n\n‚ú® Happy Diwali! ‚ú®`;
        
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
    }
</script>

<style media="print">
    body {
        background: white !important;
        padding: 0;
    }
    
    .header, .card, .action-buttons, .screenshot-hint {
        display: none !important;
    }
    
    .container {
        max-width: 100%;
        padding: 0;
    }
    
    .pass-preview {
        box-shadow: none;
        page-break-inside: avoid;
    }
</style>
{% endblock %}